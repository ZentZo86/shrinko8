pico-8 cartridge // http://www.pico-8.com
version 36
__lua__

f = 1
assert(true, 1)
assert(f == 1, 2)
assert("\0ᶜ3\n	⁵Aa" == "\0ᶜ3\n	⁵Aa")
assert("'\"\\'" == [['"\']], 3)
assert("]]" == "]]", 4)
f = 1
p = 1
assert(f == 1 and p == 1, 5)
assert(0xf.f == 0xf.f and 2.25 == 2.25, 6)
e, o, c = 1, {}, 3
e, o.n, o[1], c = c, 2, 4, e
assert(e == 3 and c == 1 and o["n"] == 2 and o[1] == 4, 8)
do
  local n = e + 1
  assert(n == 4, 9)
  local n = n * 2
  assert(n == 8, 9.1)
end
assert(e == 3, 9.2)
local t = _ENV
assert(t == _ENV, 10)
local t
assert(t == nil, 11)

function d()
  return 1, 2, 3
end

local t, u, c, f, g, p = 0, d()
assert(t == 0 and u == 1 and c == 2 and f == 3 and g == nil and p == nil, 12)

function d(...)
  return ...
end

assert(d(1, 2, 3) == 1, 13)
e, o = (d(1, 2))
assert(e == 1 and o == nil, 14)
e, o = d(1, 2), 3
assert(e == 1 and o == 3, 15)
assert(pack(d(1, 2, nil, 3, nil, nil)).n == 6, 16)

function d(...)
  return ..., ..., ...
end

assert(pack(d(1, 2, 3)).n == 5, 17)
for n = 1, 3 do
  assert(select(n, d(1, 2, 3)) == 1, 18)
end
assert(select(4, d(1, 2, 3)) == 2, 19)
n = 0
for e = 5, 1, -2 do
  n = 1
  assert(e == 5 or e == 3 or e == 1, 20)
end
assert(n == 1, 20.5)
for n = 5, 1 do
  assert(false, 21)
end
n = 0
for e, d in ipairs {4, 5} do
  assert(e == 1 and d == 4 or e == 2 and d == 5, 22)
  n += 1
end
assert(n == 2, 22.5)
if n == 2 then
  n += 1
else
  assert(false, 23)
end
assert(n == 3, 23.5)
if n == 2 then
  assert(false, 24)
elseif n == 3 then
  n += 1
else
  assert(false, 24.5)
end
assert(n == 4, 24.6)
if n == 2 then
  assert(false, 25)
else
  n += 1
end
assert(n == 5, 25.5)
if (n == 5) n = 0; n = 1 else assert(false, 26)
assert(n == 1, 27)
if (n == 5) assert(false, 28) else n = 2
assert(n == 2, 29)
l = 1
while (n > 0) n -= 1; l *= 2
assert(l == 4 and n == 0, 30)
while l > 0 do
  l -= 1
  n += 1
end
assert(n == 4 and l == 0, 31)
while n > 0 do
  n -= 1
  l += 1
  if l == 3 then
    break
  end
end
assert(n == 1 and l == 3, 32)
repeat
  n += 1
  l -= 1
until n == 1 or n == 3
assert(n == 3 and l == 1, 33)

function d()
  return
end

function a()
end

assert(d() == nil and pack(d()).n == 0, 34)
assert(a() == nil and pack(a()).n == 0, 35)

function s(...)
  return ...
end

e = {1, 2, e = 1, o = 2, 3, 4, [12] = 4, s(5, 6, nil, 8)}
assert(e[1] == 1 and e[2] == 2 and e[3] == 3 and e[4] == 4 and e[5] == 5 and e[6] == 6, 36)
assert(e[7] == nil and e[8] == 8 and e["e"] == 1 and e.o == 2 and e[12] == 4, 37)

function s(...)
  return {...}
end

do
  local function n(...)
    return {..., e = 3}
  end

  assert(#n(1, 2) == 1 and n(1, 2).e == 3, 38)
end
assert(#s(1, 2) == 2, 39)
assert(1 + 4 * 5 == 21 and 498 & 255 << 4 == 496, 40)
assert((1 + 4) * 5 == 25 and (498 & 255) << 4 == 3872, 41)
assert(-2 ^ 4 == -16 and (-2) ^ 4 == 16, 42)
assert(1 ~= 2 and 1 ~= 2 or assert(false, 43), 43.1)
f = {d = function(n)
  return n.u
end, u = 3}
assert(f:d() == 3 and f.d {u = 4} == 4, 44)
setmetatable(f, {__index = function(e, n)
  return n
end})
assert(f.b == "b", 45)
f.a = f

function f.a.a.u(n)
  return n
end

assert(f.u(false) == false, 46)

function f.a.a:g(n)
  return self, n
end

assert(f:g(true) == f and select(2, f:g(true)) == true, 47)
do
  t = 1
  do
    ::n::
    t += 1
    if (t == 4) goto e
    goto n
  end
  ::e::
  assert(t == 4, 48)
end
do
  ::n::
  do
    goto n
    assert(false, 49)
    ::n::
  end
end
t = 0
for n, e in next, {5} do
  assert(n == 1 and e == 5, 50)
  t += 1
end
assert(t == 1, 50.5)
do
  local n, _ENV = add, {assert = assert}
  n(_ENV, 3)
  assert(_ENV[1] == 3, 51)
end

local function n(n)
  _ENV = n
end

local e = _ENV
n {assert = assert, z = 123}
assert(z == 123, 52)
n(e)

function d()
  return 9, 0, 1
end

function A(n)
  return n()
end

function B(n)
  return (n())
end

assert(pack(A(d)).n == 3 and pack(B(d)).n == 1, 53)
t = 72
t -= 4 * 2
t >>>= 16
assert(t == .00098, 54)
if t < 1 then
  if (t == 0) t = 123
else
  t = 321
end
assert(t == .00098, 55)
do
  local n = 1

  function n()
  end

end
assert(O == nil, 56)
t = 1
repeat
  local n = 2
until assert(n == 2, 57)
do
  local n = 2
  repeat
    local e = 3
  until assert(n * e == 6, 57.5)
end

local function d()
  return 3
end

assert(-d() + d() == 0, 58)

local function e()
  return d
end

assert(e()() == 3, 59)

local function n(e, d)
  local o = function()
    e += 1
    return e
  end
  if d and d > 0 then
    return o, n(e * 2, d - 1)
  else
    return o
  end
end

local o, l, a, t = n(10), n(20), n(30, 1)
assert(o() == 11 and l() == 21 and n(0)() == 1 and a() == 31 and t() == 61 and o() == 12 and l() == 22 and n(0)() == 1 and a() == 32 and t() == 62, 60)

function r(n)
  return n
end

assert(r "me" == "me" and r [[me]] == "me", 61)
m = {r = function(e, n)
  return n
end}
assert(m:r "me" == "me" and #m:r {} == 0, 62)
do
  while true do
    if 1 == 1 then
      ::n::
    end
    goto n
  end
  ::n::
end
local n = 1

function k()
  return n
end

local n = 2
assert(k() == 1, 63)
local n = 1
do
  function D()
    return n
  end

  local n = 2
  assert(D() == 1, 64)
end
do
  local n, e = 1, 2
  ::n::
  assert(e == 2, 65)
  if (n > 1) assert(i() == 4 and e == 2, 66); goto e
  local e = 3
  i = function()
    e += 1
    return e
  end
  n += 1
  goto n
end
::e::
do
  local n = 1
  ::n::
  local d = n
  e = i
  i = function()
    d += 1
    return d
  end
  n += 1
  if (n == 3) goto d else goto n
end
::d::
assert(i() == 3 and i() == 4 and e() == 2 and i() == 5 and e() == 3, 67)
do
  goto n
  local n
  ::n::
end
if (1 == 1) ;
local n = 0

function ord(e, d)
  assert(n == e, 68)
  n += 1
  return d
end

local n = {}
ord(0, n).f, ord(1, n).f = ord(2, 2), ord(3, function()
  return 3
end)(ord(4, 1), ord(5, 1))
assert(n.f == 2, 69)
local o, n = 1, 2
assert(n == 2, 70)

function d(e, n)
  assert(n == 2, 71)
end

d(1, 2)
w = 0
x = {10, 20}

function e()
  w += 1
  return w
end

x[e()] += 1
assert(x[1] == 11 and x[2] == 20, 72)
n = 0
n += 16
assert(n == 16, 73)
assert([[[[]] == "[[", 73.5)
if (1 == 1) if (2 == 3) n = 1 else n = 2
assert(n == 2, 74)
if (1 == 2) h = 1 else if (1 == 3) h = 2 else h = 3
assert(h == 3, 76)
if (1 == 1) if 2 == 2 then n = 4 else n = 5 end else n = 6
assert(n == 4, 77)
do
  n = 0
  if (1 == 2) ;
end
n = 123
assert(n == 123, 78)
do
  local n
  print = function(e)
    n = e
  end
  ?1
  assert(n == 1, 79)
end
do
  local n
  local print = function(e)
    n = e
  end
  ?2
  assert(n == 2, 80)
end
printh "DONE"

__gfx__
dcf6c3968fc4f9d8632d39e67f3953076b48f7b7a87b8f3a1c7d3c647677c0aa345a17500639192c448e3ae773c1ef4b9b8ced74657b1a43f0d23d321a0ad40a
4c49a63747ffeabf17d2d2b36f4ee65c129fbbb1663d2dc2ab0daefb2326aec74f6acf74d9ab50d107f004901073e9cfa89bf6908d49a65e45a6804661ba5179
__map__
7abd0b061b85dc7a3d47cae943ce8effc7516254f412bd5cfe0ccd4857697bd16a75fa3860d4b836040c9d134e2c4816dd157b192c7815d386d6a9838d997b68f1082175bcdb96c6dcac0476ff502de82a4c22f317e3e8f3fe2133ce4bdd5d16be563ae2414cbb4f6df414c07c602ff7d6836f48be07f9c16da0b3a334de4848
__gff__
aa52cccc84159c6328341bff1000c7ebefa69980293c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
123000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004
__music__
07 12345678
__label__
v0606660600060000660000060600660666060006600000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6v606000600060006060000060606060606060006060000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66v06600600060006060000060606060660060006060000000000000000000000000000000000000000000000000000000000000000000000000000000000000
606v6000600060006060000066606060606060006060000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6060v660666066606600000066606600606066606660000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000v00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000v0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000v000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000v00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000v0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000v000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000v00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000v0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000v000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000v00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000v0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000v000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000v00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000v0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000v000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000v00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000v0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000v000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000v00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000v0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000v000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000v00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000v0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000v000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000v00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000v0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000v000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000v00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000v0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000v000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000v00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000v0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000v000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000v00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000v0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000v000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000v00000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000v0000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000v000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000v00000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000v0000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000v000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000v00000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000v0000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000v000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000v00000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000v0000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000v000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000v00000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000v0000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000v000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000v00000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000v0000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000v000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000v00000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000v0000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000v000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000v00000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000v0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000v000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000v00000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000v0000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000v000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000v00000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000v0000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000v000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000v00000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000v0000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000v000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000v00000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000v0000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000v000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000v00000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000v0000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000v000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000v00000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000v0000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000v000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000v00000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000v0000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000v000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000v00000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000v0000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000v000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000v00000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000v0000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000v000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000v00000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000v0000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000v000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000v00000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000v0000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000v000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000v00000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000v0000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000v000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0123456789abcde00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__meta:hello__
hello1
hello2
__meta:hello2__
hello3
hello4
__meta:title__
this tests a good deal of syntax